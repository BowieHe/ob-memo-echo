# Obsidian Memo Echo - PRD v0.7.0

## 版本信息

- **版本**: 0.7.0
- **代号**: "轻量设置" (Lean Settings)
- **状态**: Draft
- **前置版本**: v0.6.0 (Smart Associations)
- **核心目标**: 聚焦核心功能，减少无效设置，提升稳定性和可理解性

---

## 1. 核心目标

v0.6.0 完成了概念抽象与关联发现。v0.7.0 将重点收敛：

1. **设置页瘦身**：删除无效或未落地的选项，减少认知负担
2. **配置可用性**：关键配置（Qdrant URL/集合名）必须真实生效
3. **服务兼容**：保留本地 Ollama 与 OpenAI-compatible 的统一配置入口
4. **代码清理**：移除底层已不存在的功能点，降低维护成本

---

## 2. 本次修改清单（标注本次调整）

### 2.1 设置页裁剪（必做）

- **移除** `createConceptPages`：自动创建概念页功能无底层实现，删除该开关
- **移除** `enableIncrementalIndexing`：增量索引逻辑未接入任何流程，删除该开关
- **固定** 概念页前缀 `_me`：不再暴露输入框，仅保留一行简短说明
- **移除** Ollama 连接检查按钮：不再进行连通性验证，避免误导

### 2.2 配置生效修复（必做）

- **修复** Qdrant URL / 集合名称设置：UI 必须读写 `settings` 并生效

### 2.3 配置语义统一（必做）

- **统一** 模型服务入口说明：
  - `localhost` 视为 Ollama（无需 API Key）
  - 非本地 URL 视为 OpenAI-compatible（默认可直接使用）

---

## 3. 设置页最终结构（目标形态）

### 3.1 仅保留的核心设置

- **向量搜索**
  - Embedding 提供商（local / ollama / openai）
  - Embedding 服务地址（URL）
  - 模型名称

- **AI 智能提取（总结/标签）**
  - 启用/关闭
  - 提供商（ollama / openai）
  - Base URL（支持 OpenAI-compatible）
  - 模型名称

- **Qdrant**
  - URL
  - 集合名称

- **概念注入**
  - 启用/关闭
  - 概念提取方式（ollama / openai / rules）
  - 概念前缀说明（固定 `_me`）
  - 抽象概念偏好 + 置信度过滤 + 通用概念排除

- **关联发现**
  - 保留开关与基础阈值
  - 高级选项（批量上限、自动接受阈值）可视为高级折叠

### 3.2 删除/隐藏的设置

- 自动创建概念页
- 增量索引开关
- Ollama 连接检查按钮

---

## 4. 用户体验目标

1. **设置页 3 分钟可理解**：用户无需阅读文档即可完成配置
2. **减少“无效设置”**：删除不生效的开关，避免误导
3. **默认即可用**：未修改设置时使用合理默认值

---

## 5. 技术设计（简化规则）

### 5.1 概念页前缀固定

```yaml
me_concepts:
  - "[[_me/幂等性]]"
  - "[[_me/事件驱动]]"
```

- `_me` 前缀作为内置约定，简化配置与迁移
- 不再暴露 `conceptPageFolder` 输入

### 5.2 OpenAI-compatible 基础 URL

- `aiGenUrl` 作为统一 Base URL
- `localhost` 视为 Ollama；非本地则视为 OpenAI-compatible
- API Key 仅在非本地地址生效

---

## 6. 迁移策略

- 原有设置保留读取，不强制迁移
- 删除的字段不再保存，避免脏数据持续存在
- 已存在的 `me_concepts` 与 `_me/` 前缀保持兼容

---

## 7. 风险与缓解

- **风险**: 用户仍希望自定义 `_me` 前缀
  - **缓解**: 明确告知“固定前缀可减少混乱，未来可评估高级模式”

- **风险**: 删除设置项导致用户误认为功能消失
  - **缓解**: 在更新日志注明“移除无效设置，不影响现有功能”

---

## 8. 我对仓库的额外想法（暂不纳入 v0.7.0）

1. **后端选择收敛**：当前代码内存在 LanceDB 实现，但无入口；可在后续版本明确“支持/移除”策略
2. **索引流程统一入口**：设置页存在多个索引入口（索引当前/全量同步/关联重扫），建议将“索引动作”集中到一个面板
3. **清理 me_* 的 UX**：当前清除操作分散在设置页和关联面板，建议统一为“数据安全”小节
4. **日志等级控制**：大量 `console.log` 常驻，建议引入可开关的 debug 模式

---

## 9. 实现阶段（建议）

### Phase 1: 设置页清理
- 移除无效设置
- 修复 Qdrant 配置生效
- 简化概念页设置显示

### Phase 2: 逻辑清理
- 删除不使用的配置字段
- 清理与废弃配置相关的 UI 逻辑

### Phase 3: 文档与更新日志
- 更新 README / 更新记录
- 说明“删除无效设置、不影响功能”

---

**文档状态**: Draft v1.0
**最后更新**: 2026-01-27
