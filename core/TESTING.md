# ğŸ§ª æµ‹è¯•æŒ‡å—

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•é€æ­¥æµ‹è¯•æ¯ä¸ªæ¨¡å—ï¼Œç¡®ä¿ç³»ç»Ÿæ­£å¸¸å·¥ä½œã€‚

## ğŸ“‹ å‰ç½®æ¡ä»¶

### 1. å¯åŠ¨ Ollama

```bash
# ç¡®ä¿ Ollama æ­£åœ¨è¿è¡Œ
ollama serve

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯ï¼Œæ‹‰å– Embedding æ¨¡å‹
ollama pull nomic-embed-text
```

éªŒè¯ Ollama æ˜¯å¦æ­£å¸¸ï¼š

```bash
curl http://localhost:11434/api/tags
```

### 2. å¯åŠ¨ Qdrant

```bash
# ä½¿ç”¨ Dockerï¼ˆæ¨èï¼‰
docker run -d -p 6333:6333 -p 6334:6334 \
    -v $(pwd)/qdrant_storage:/qdrant/storage \
    --name qdrant \
    qdrant/qdrant

# éªŒè¯ Qdrant æ˜¯å¦æ­£å¸¸
curl http://localhost:6333/collections
```

---

## ğŸš€ æµ‹è¯•æ­¥éª¤

### æµ‹è¯• 1: Ollama è¿æ¥å’Œ Embedding ç”Ÿæˆ

**ç›®çš„**: éªŒè¯ Ollama æœåŠ¡æ˜¯å¦æ­£å¸¸ï¼Œèƒ½å¦ç”Ÿæˆå‘é‡

```bash
cd /home/bowie/code/ob-image-vector/core
cargo run --example test_ollama
```

**é¢„æœŸè¾“å‡º**:

```
ğŸ§ª æµ‹è¯• Ollama Embedding æ¨¡å—
==================================================

ğŸ“¡ æ­¥éª¤ 1: æµ‹è¯• Ollama æœåŠ¡è¿æ¥...
   âœ… Ollama æœåŠ¡æ­£å¸¸è¿è¡Œ
   ğŸ“¦ å·²å®‰è£…çš„æ¨¡å‹:
      - nomic-embed-text:latest

ğŸ”¢ æ­¥éª¤ 2: æµ‹è¯• Embedding ç”Ÿæˆ...
   è¾“å…¥æ–‡æœ¬: "è¿™æ˜¯ä¸€å¼ å·´é»åŸƒè²å°”é“å¡”çš„ç…§ç‰‡"
   âœ… Embedding ç”ŸæˆæˆåŠŸ
   ğŸ“Š å‘é‡ç»´åº¦: 768
   ğŸ” å‰10ä¸ªå€¼: [0.123, -0.456, ...]

ğŸ” æ­¥éª¤ 3: æµ‹è¯•è¯­ä¹‰ç›¸ä¼¼åº¦...
   ğŸ“Š ç›¸ä¼¼åº¦çŸ©é˜µ:
   1.000  0.856  0.234
   0.856  1.000  0.198
   0.234  0.198  1.000

   ğŸ’¡ è§£è¯»:
      "åŸƒè²å°”é“å¡”" vs "æ³•å›½æ—…æ¸¸": 0.856 (åº”è¯¥è¾ƒé«˜)
      "åŸƒè²å°”é“å¡”" vs "çŒ«å’ªç…§ç‰‡": 0.234 (åº”è¯¥è¾ƒä½)
   âœ… è¯­ä¹‰ç†è§£æ­£å¸¸ï¼

âœ¨ Ollama æµ‹è¯•å®Œæˆï¼
```

**å¦‚æœå¤±è´¥**:

-   æ£€æŸ¥ Ollama æ˜¯å¦è¿è¡Œ: `ps aux | grep ollama`
-   æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨: `lsof -i :11434`
-   æŸ¥çœ‹ Ollama æ—¥å¿—

---

### æµ‹è¯• 2: Qdrant è¿æ¥å’Œå‘é‡æ“ä½œ

**ç›®çš„**: éªŒè¯ Qdrant æ•°æ®åº“æ˜¯å¦æ­£å¸¸ï¼Œèƒ½å¦å­˜å‚¨å’Œæœç´¢å‘é‡

```bash
cargo run --example test_qdrant
```

**é¢„æœŸè¾“å‡º**:

```
ğŸ§ª æµ‹è¯• Qdrant å‘é‡æ•°æ®åº“
==================================================

ğŸ“¡ æ­¥éª¤ 1: è¿æ¥åˆ° Qdrant...
   âœ… Qdrant è¿æ¥æˆåŠŸ

ğŸ—‚ï¸  æ­¥éª¤ 2: åˆ›å»ºæµ‹è¯•é›†åˆ 'test_collection'...
   âœ… é›†åˆåˆ›å»ºæˆåŠŸ

ğŸ’¾ æ­¥éª¤ 3: æ’å…¥æµ‹è¯•å‘é‡...
   âœ… æ’å…¥äº† 3 ä¸ªæµ‹è¯•ç‚¹

ğŸ“Š æ­¥éª¤ 4: æŸ¥è¯¢é›†åˆä¿¡æ¯...
   é›†åˆåç§°: test_collection
   å‘é‡ç»´åº¦: 768
   è·ç¦»åº¦é‡: Cosine
   ç‚¹æ•°é‡: 3

ğŸ” æ­¥éª¤ 5: æµ‹è¯•å‘é‡æœç´¢...
   æŸ¥è¯¢å‘é‡: [0.15; 768]
   æœç´¢ç»“æœ (Top 3):

   1. ID: 2
      ç›¸ä¼¼åº¦: 0.9999
      æ–‡æœ¬: {"kind":"stringValue","stringValue":"æ³•å›½å¢æµ®å®«"}
      åˆ†ç±»: {"kind":"stringValue","stringValue":"travel"}

âœ¨ Qdrant æµ‹è¯•å®Œæˆï¼
```

**å¦‚æœå¤±è´¥**:

-   æ£€æŸ¥ Docker å®¹å™¨: `docker ps | grep qdrant`
-   æ£€æŸ¥ç«¯å£: `lsof -i :6334`
-   æŸ¥çœ‹ Qdrant æ—¥å¿—: `docker logs qdrant`

---

### æµ‹è¯• 3: å®Œæ•´é›†æˆæµ‹è¯•

**ç›®çš„**: éªŒè¯ Ollama + Qdrant çš„å®Œæ•´æµç¨‹

```bash
cargo run --example test_integration
```

**é¢„æœŸè¾“å‡º**:

```
ğŸ§ª æµ‹è¯•å®Œæ•´é›†æˆæµç¨‹
==================================================

ğŸ¤– æ­¥éª¤ 1: åˆå§‹åŒ– Ollama Embedding...
   âœ… Ollama å°±ç»ª

ğŸ“Š æ­¥éª¤ 2: åˆå§‹åŒ– Qdrant æ•°æ®åº“...
   âœ… Qdrant è¿æ¥æˆåŠŸ

ğŸ—‚ï¸  æ­¥éª¤ 3: åˆ›å»ºå‘é‡é›†åˆ...
   âœ… é›†åˆåˆå§‹åŒ–å®Œæˆ

ğŸ–¼ï¸  æ­¥éª¤ 4: ç´¢å¼•æµ‹è¯•å›¾ç‰‡...

   [1/3] å¤„ç†: /vault/Travel/France/paris_eiffel.jpg
      âœ“ ç”Ÿæˆå‘é‡ (768ç»´)
      âœ“ å·²å­˜å…¥æ•°æ®åº“
   ...

ğŸ” æ­¥éª¤ 5: æµ‹è¯•è¯­ä¹‰æœç´¢...

   æŸ¥è¯¢: "æ³•å›½å·´é»çš„æ—…æ¸¸æ™¯ç‚¹"
   ç»“æœ:
      1. /vault/Travel/France/paris_eiffel.jpg (ç›¸ä¼¼åº¦: 0.823)
      2. /vault/Travel/France/louvre_museum.jpg (ç›¸ä¼¼åº¦: 0.791)

   æŸ¥è¯¢: "çŒ«å’ªå® ç‰©ç…§ç‰‡"
   ç»“æœ:
      1. /vault/Pets/my_cat.jpg (ç›¸ä¼¼åº¦: 0.856)
      2. /vault/Travel/France/paris_eiffel.jpg (ç›¸ä¼¼åº¦: 0.234)

âœ¨ é›†æˆæµ‹è¯•å®Œæˆï¼
```

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. `cargo run` ç¼–è¯‘é”™è¯¯

```bash
# æ¸…ç†å¹¶é‡æ–°æ„å»º
cargo clean
cargo build
```

### 2. Ollama æ¨¡å‹æœªå®‰è£…

```bash
# æŸ¥çœ‹å·²å®‰è£…çš„æ¨¡å‹
ollama list

# æ‹‰å– nomic-embed-text
ollama pull nomic-embed-text
```

### 3. Qdrant è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥ Docker å®¹å™¨çŠ¶æ€
docker ps -a | grep qdrant

# é‡å¯å®¹å™¨
docker restart qdrant

# æˆ–é‡æ–°åˆ›å»º
docker rm -f qdrant
docker run -d -p 6334:6334 --name qdrant qdrant/qdrant
```

### 4. ç«¯å£è¢«å ç”¨

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :11434  # Ollama
lsof -i :6334   # Qdrant

# æ€æ­»å ç”¨è¿›ç¨‹
kill -9 <PID>
```

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

-   [ ] Ollama æœåŠ¡æ­£å¸¸è¿è¡Œ
-   [ ] nomic-embed-text æ¨¡å‹å·²å®‰è£…
-   [ ] Ollama èƒ½ç”Ÿæˆ 768 ç»´å‘é‡
-   [ ] è¯­ä¹‰ç›¸ä¼¼åº¦è®¡ç®—æ­£ç¡®
-   [ ] Qdrant æœåŠ¡æ­£å¸¸è¿è¡Œ
-   [ ] èƒ½åˆ›å»ºå’Œåˆ é™¤é›†åˆ
-   [ ] èƒ½æ’å…¥å’Œæœç´¢å‘é‡
-   [ ] å®Œæ•´æµç¨‹æµ‹è¯•é€šè¿‡

---

## ğŸ¯ ä¸‹ä¸€æ­¥

æ‰€æœ‰æµ‹è¯•é€šè¿‡åï¼Œå¯ä»¥ç»§ç»­å¼€å‘ï¼š

1. **ä¸Šä¸‹æ–‡æå–æ¨¡å—** (`context.rs`)

    - æ‰«æ Obsidian vault
    - è§£æ Markdown æ–‡ä»¶
    - æå–å›¾ç‰‡å‘¨å›´æ–‡æœ¬

2. **æœç´¢ API** (åœ¨ `db.rs` ä¸­æ·»åŠ  `search` æ–¹æ³•)

3. **Web æœåŠ¡** (`server.rs`)

    - æä¾› HTTP API
    - ä¾› Obsidian æ’ä»¶è°ƒç”¨

4. **æ–‡ä»¶ç›‘å¬** (`watcher.rs`)
    - ç›‘å¬æ–‡ä»¶å˜åŒ–
    - å¢é‡ç´¢å¼•
